@page
@{
	Layout = "Shared/_GameLayout";
}

@model CityVilleDotnet.Api.Pages.Friends.ListModel

@section Header {
	<script type="text/javascript" src="/jquery.min.js"></script>
	<script type="text/javascript" src="/flash_integration.min.js"></script>
	<script type="text/javascript" src="/swfobject.min.js"></script>
}

<div class="gamePage">
	<div class="tabs">
		<div class="tab-content">
			<div class="tab">
				<a href="/Game" title="Game">Game</a>
			</div>

			<div class="tab selected">
				<a href="/Friends/List" title="Friends">Friends</a>
			</div>
		</div>

		<div class="tab-content">
			<div class="tab">
				<a href="#" title="Username">@Model.CurrentUser?.UserName</a>
			</div>

			<div class="tab">
				<a href="#" title="/logout">Disconnect</a>
			</div>
		</div>
	</div>

	<div class="main">
		@if (TempData["Error"] != null)
		{
			<div class="alert alert-error">@TempData["Error"]</div>
		}
		@if (TempData["Success"] != null)
		{
			<div class="alert alert-success">@TempData["Success"]</div>
		}

		<form asp-page-handler="AddFriend" method="post" class="add-friend">
			<label>Add Friend</label>
			<div>
				<input type="text" asp-for="Username" placeholder="Enter username..."/>
				<button type="submit">Add Friend</button>
			</div>
		</form>

		<h2 class="section-title">Friends
			(@Model.Friends.Count(x => x.Status == Domain.Entities.FriendshipStatus.Accepted))</h2>

		@{
			var acceptedFriends = Model.Friends.Where(x => x.Status == Domain.Entities.FriendshipStatus.Accepted).ToList();
		}

		@if (acceptedFriends.Any())
		{
			<div class="friends">
				@foreach (var item in acceptedFriends)
				{
					<div class="friend">
						<img src="/blank.png" alt="@item.UserName's avatar"/>
						<div class="friend-content">
							<div>@item.UserName</div>
							<div>Level @item.Level</div>
						</div>
					</div>
				}
			</div>
		}
		else
		{
			<div class="empty-state">No friends yet. Add some friends to get started!</div>
		}

		<h2 class="section-title">Pending Requests
			(@Model.Friends.Count(x => x.Status == Domain.Entities.FriendshipStatus.Pending))</h2>

		@{
			var pendingFriends = Model.Friends.Where(x => x.Status == Domain.Entities.FriendshipStatus.Pending).ToList();
		}

		@if (pendingFriends.Any())
		{
			<div class="friends">
				@foreach (var item in pendingFriends)
				{
					<div class="friend">
						<img src="/blank.png" alt="@item.UserName's avatar"/>
						<div class="friend-content">
							<div>@item.UserName</div>
							<div>Level @item.Level</div>
							<div class="interactions">
								@if (!item.Requested)
								{
									<a class="cancel" asp-page-handler="Cancel" asp-route-userName="@item.UserName"
									   title="Cancel friend request">Cancel</a>
								}
								else
								{
									<a class="accept" asp-page-handler="Accept" asp-route-userName="@item.UserName"
									   title="Accept friend request">Accept</a>
									<a class="reject" asp-page-handler="Reject" asp-route-userName="@item.UserName"
									   title="Reject friend request">Reject</a>
								}
							</div>
						</div>
					</div>
				}
			</div>
		}
		else
		{
			<div class="empty-state">No pending friend requests.</div>
		}
	</div>
</div>